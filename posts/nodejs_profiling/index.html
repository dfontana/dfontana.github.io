<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>Profiling in NodeJS with Environment Variables &middot; Dylan.</title>
    <meta name="author" content="Dylan Fontana">
    <meta name="description" content="A portfolio site.">
    <meta name="generator" content="Hugo 0.29" />
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <!-- RSS autodiscovery -->
    

    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/css/screen.css">
    <link rel="stylesheet" href="/css/github.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/default.min.css">
    

    
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico">
    

    <!-- Stylesheet for theme color -->
    <style type="text/css">
    a, a:visited {color: #33cc99;}
    .pagination a {color: #33cc99;}
    .gist .gist-file .gist-meta a:visited {color: #33cc99 !important;}
    a:focus, a:hover {color: #178b6b;}
    h1.post-title a:focus, h1.post-title a:hover, h1.blog-title a:focus, h1.blog-title a:hover {color: #178b6b;}
    .older-posts:hover, .newer-posts:hover {color: #178b6b;}
</style>
</head>

<body class="home-template">
    <header id="site-head">
	
	<h1 class="blog-title"><a href="/">Dylan.</a></h1>
	
	
	<h1 class="blog-subtitle">Thoughts, ideas, and works.</h1>
	
</header>
    
<nav class="menu" role="nav">
    <ul>
        
        	<li class="nav nav-current"><a href="/">Home</a></li>
      	
        	<li class="nav nav-current"><a href="/posts/">Posts</a></li>
      	
        	<li class="nav nav-current"><a href="/projects/">Projects</a></li>
      	
        	<li class="nav nav-current"><a href="/about/">About</a></li>
      	
    </ul>
</nav>

    
    <main class="content" role="main">
    
<article class="post">
    <header>
        <h1 class="post-title">Profiling in NodeJS with Environment Variables</h1>
        <div class="post-meta">
            <time datetime="13 October 2017">
                13 October 2017
            </time>
        </div>
    </header>

    <section class="post-content">
        

<p>While standing up a REST API for a work project, I spent a lot of time editing the IP, port, and other parameters within my server as I swapped from production and development environments. After being fed up with the constant back and forth, I searched for a better solution. In this tidbit, I&rsquo;m going to present my solution.</p>

<h2 id="reading-environment-variables-in-node">Reading Environment Variables in Node</h2>

<p>An easy solution would be to simply pass environment variables when launching NodeJS, pulling the configuration from inside our files to the commandline during launch time. We can accomplish this like so:</p>

<pre><code class="language-javascript">location=Boston node server.js
</code></pre>

<p>Once we&rsquo;ve set these variables, its a simple matter of reading them inside Node. Thankfully, Node has the <code>process</code> object, which allows us to look at environment variables through <code>env</code>. To access a variable called <code>location</code>, for example, we&rsquo;d simple do:</p>

<pre><code class="language-javascript">var location = process.env.location || 'New_York';
</code></pre>

<p>Notice we set a default value with a logical OR. It&rsquo;s important to remember this, to prevent undefined behavior when someone forgets to set the variable or if you have a default value in mind.</p>

<p>This is still not the ideal scenario, however. Let&rsquo;s harp on the notion of a default configuration. We&rsquo;ve successfully pulled out our configuration using environment variables, but if I want to change the default configs then I&rsquo;m back to my original problem of editing source code! Luckily, we can do one extra tweak to solve just this.</p>

<h2 id="the-magic-of-profiles-and-jsons">The Magic of Profiles and JSONs</h2>

<p>Here&rsquo;s where profiling comes in. What if we were to place all our configurations within a file (like a JSON) and load it in at runtime? What if we did one better, and made it a module that can handle comments AND specify all our configurations within itself - rather than specifying our default configuration within our source. Well we can! And we will:</p>

<pre><code class="language-javascript">// config.js
let env = process.env.CONFIG || 'default';
let config = {};

/**
 * config.IP: IP of database.
 * config.PORT: Port number of database.
 * config.LOG_LEVEL: Trace level to print when logging events.
 */
switch(env){
    case('prod'):
        config.IP = '127.127.127.127';
        config.PORT = 80;
        config.LOG_LEVEL = 1;
        break;
    default:
        config.IP = '127.0.0.0';
        config.PORT = 8080;
        config.LOG_LEVEL = 2;
}

module.exports = config;
</code></pre>

<p>And then in our server.js, we:</p>

<pre><code class="language-javascript">//Import configuration
const config = require('./config');

...

//Access it's fields
console.log(config.IP);
</code></pre>

<p>And we call our server as such:</p>

<pre><code class="language-shell">CONFIG=prod node server.js
</code></pre>

<p>That&rsquo;s it! We&rsquo;ve gone from hard coded messes, to flexible, documentable, and &ldquo;gitignore-able&rdquo; configurations that can change without modifying the original source.</p>

    </section>

    
    <section class="post-tags" style="padding-bottom:60px;">
        <div class="post-meta tags">
            <i class="fa fa-fw fa-tag"></i>
            
        </div>
    </section>
    
    
    <section class="share">
    <p class="backtotop"><a data-scroll href="#site-head"><i class="fa fa-lg fa-fw fa-angle-double-up"></i></a><a data-scroll class="backtotoptext" href="#site-head"> Back to top</a></p>
    <p class="info prompt">Share</p>
    <a href="http://twitter.com/share?text=Profiling%20in%20NodeJS%20with%20Environment%20Variables&url=%2fposts%2fnodejs_profiling%2f" title="Share on Twitter"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <i class="fa fa-2x fa-fw fa-twitter-square"></i> <span class="hidden">Twitter</span>
    </a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=%2fposts%2fnodejs_profiling%2f" title="Share on Facebook"
        onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <i class="fa fa-2x fa-fw fa-facebook-square" style="margin-left: -8px"></i> <span class="hidden">Facebook</span>
    </a>
    <a href="https://plus.google.com/share?url=%2fposts%2fnodejs_profiling%2f" title="Share on Google+"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <i class="fa fa-2x fa-fw fa-google-plus-square" style="margin-left: -8px"></i> <span class="hidden">Google+</span>
    </a>
</section>

    <footer class="post-footer">
        
<section class="author">
    <div class="authorimage" style="background: url(/img/profile.png)"></div>
    <h4>Dylan Fontana</h4>
    <p class="bio">Explore, learn, and pursue - three of my favorite things.</p>
    <p class="meta">
      <i class="fa fa-fw fa-map-marker"></i> America/Boston
    </p>
</section>
    </footer>
    
</article>

    </main>

    

<footer class="site-footer">
	<div class="inner">
		<section class="footer-social">
      
      
      <a href="//www.linkedin.com/in/dylan-fontana" target="_blank" title="linkedIn"><i class="fa fa-2x fa-fw fa-linkedin"></i> <span class="hidden">LinkedIn</span></a>&nbsp;
      
      
      
      
      
      <a href="//github.com/dfontana" target="_blank" title="GitHub"><i class="fa fa-2x fa-fw fa-github"></i> <span class="hidden">GitHub</span></a>&nbsp;
      
      
      
      
  </section>

		<section class="copyright">&copy; 2017 <a href="/about/">Dylan Fontana</a>. Released under the MIT license.</section>
	</div>
</footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script src="/js/smooth-scroll.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>


<script>
    smoothScroll.init({
        speed: 800,
        easing: 'easeInOutCubic',
        updateURL: false,
        offset: 125,
    });
</script>
<script>hljs.initHighlightingOnLoad();</script>


</body>
</html>